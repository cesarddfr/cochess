<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ciudad Top-Down</title>

<style>
body{
  margin:0;
  background:#1b1b1b;
  overflow:hidden;
  font-family:Arial, sans-serif;
}

#ui{
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  z-index:10;
}

/* MAPA */
#map{
  position:relative;
  width:2000px;
  height:2000px;
  background:#2b2b2b;
}

/* Calles */
.road{
  position:absolute;
  background:#555;
}

.road.green{
  background:#0c3f23;
  box-shadow:0 0 20px #00ff88 inset;
}

/* Coche jugador */
#player{
  position:absolute;
  width:50px;
  height:90px;
  transform-origin:50% 50%;
}

/* SVG coche */
svg{width:100%;height:100%;}

#batteryBox{
  position:absolute;
  top:-35px;
  width:100%;
  text-align:center;
  font-size:10px;
  color:white;
}

#batteryBar{
  height:6px;
  background:red;
}

#batteryFill{
  height:100%;
  width:100%;
  background:lime;
}

/* Coches NPC */
.npc{
  position:absolute;
  width:45px;
  height:80px;
  opacity:.85;
}
</style>
</head>

<body>

<div id="ui">
  <div id="speed">Velocidad: 0 km/h</div>
</div>

<div id="map">

  <!-- ROADS -->
  <div class="road" style="left:300px;top:0;width:120px;height:2000px"></div>
  <div class="road green" style="left:600px;top:0;width:120px;height:2000px"></div>
  <div class="road" style="left:900px;top:0;width:120px;height:2000px"></div>

  <div class="road" style="top:400px;left:0;width:2000px;height:120px"></div>
  <div class="road green" style="top:900px;left:0;width:2000px;height:120px"></div>
  <div class="road" style="top:1400px;left:0;width:2000px;height:120px"></div>

  <!-- PLAYER -->
  <div id="player" style="left:350px;top:800px">
    <div id="batteryBox">
      BATERÍA
      <div id="batteryBar">
        <div id="batteryFill"></div>
      </div>
    </div>

    <svg viewBox="0 0 60 110">
      <path id="body" d="M10 5 Q30 -5 50 5 L55 30 L55 90 Q30 105 5 90 L5 30 Z" fill="#d40000"/>
      <rect x="18" y="22" width="24" height="22" rx="5" fill="#9ddcff"/>
      <rect x="8" y="35" width="6" height="20" rx="3"/>
      <rect x="46" y="35" width="6" height="20" rx="3"/>
      <rect x="8" y="70" width="6" height="20" rx="3"/>
      <rect x="46" y="70" width="6" height="20" rx="3"/>
    </svg>
  </div>

</div>

<script>
const player=document.getElementById("player");
const batteryFill=document.getElementById("batteryFill");
const speedText=document.getElementById("speed");
const map=document.getElementById("map");

let px=350, py=800;
let angle=0;
let speed=0;
let battery=100;
let broken=false;

/* Controles */
const keys={};
document.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
document.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

/* NPCs */
function spawnNPC(){
  const n=document.createElement("div");
  n.className="npc";
  n.innerHTML=player.querySelector("svg").outerHTML;
  map.appendChild(n);

  let x=600,y=Math.random()*2000,dir=90;
  function move(){
    y+=2;
    n.style.left=x+"px";
    n.style.top=y+"px";
    n.style.transform=`rotate(${dir}deg)`;
    if(y<2000) requestAnimationFrame(move);
    else n.remove();
  }
  move();
}
setInterval(spawnNPC,1200);

/* Loop */
function loop(){
  if(!broken){
    if(keys.a) angle-=3;
    if(keys.d) angle+=3;
    if(keys.w) speed+=0.2;
    if(keys.s) speed-=0.3;
  }

  speed=Math.max(0,Math.min(speed,140));

  const rad=angle*Math.PI/180;
  px+=Math.sin(rad)*speed*0.05;
  py-=Math.cos(rad)*speed*0.05;

  player.style.left=px+"px";
  player.style.top=py+"px";
  player.style.transform=`rotate(${angle}deg)`;

  speedText.textContent="Velocidad: "+Math.floor(speed)+" km/h";

  battery-=0.04;
  if(px>580 && px<720) battery+=0.2;
  if(py>880 && py<1020) battery+=0.2;

  battery=Math.max(0,Math.min(100,battery));
  batteryFill.style.width=battery+"%";

  if(battery<=0){
    broken=true;
    speed=0;
    speedText.textContent="AVERÍA";
  }

  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
